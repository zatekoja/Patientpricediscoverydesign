[SERVICE]
    Flush        5
    Daemon       Off
    Log_Level    info
    Parsers_File parsers.conf

# ==========================================
# Input: Docker container logs (stdout)
# ==========================================
[INPUT]
    Name              tail
    Path              /var/lib/docker/containers/*/*.log
    Parser            docker
    Tag               docker.*
    Refresh_Interval  5
    Mem_Buf_Limit     50MB
    Skip_Long_Lines   On
    DB                /var/log/flb_docker.db

# ==========================================
# Filters: Parse and enrich logs
# ==========================================

# Parse the log field if it's JSON
[FILTER]
    Name                parser
    Match               docker.*
    Key_Name            log
    Parser              json
    Reserve_Data        On

# Add base service namespace
[FILTER]
    Name                modify
    Match               docker.*
    Add                 service.namespace patient-price-discovery

# Parse container name from stream field
[FILTER]
    Name                lua
    Match               docker.*
    script              /fluent-bit/etc/enrich.lua
    call                enrich_logs

# ==========================================
# Output: Forward to SigNoz OTLP Collector
# ==========================================
[OUTPUT]
    Name                http
    Match               *
    Host                signoz-otel-collector
    Port                4318
    URI                 /v1/logs
    Format              json
    Header              Content-Type application/json
    Json_date_key       timestamp
    Json_date_format    iso8601
    Retry_Limit         5
    net.keepalive       on

# ==========================================
# Output: Stdout for debugging
# ==========================================
[OUTPUT]
    Name                stdout
    Match               *
    Format              json_lines

